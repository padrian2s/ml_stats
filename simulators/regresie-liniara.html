<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Regresie Liniara — Simulator Interactiv</title>
    <style>
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

        :root {
            --primary: #2563eb;
            --primary-light: #3b82f6;
            --primary-dark: #1d4ed8;
            --primary-bg: #eff6ff;
            --primary-border: #bfdbfe;
            --surface: #ffffff;
            --text: #1e293b;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --radius: 12px;
            --shadow: 0 4px 24px rgba(37,99,235,0.10);
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.06);
        }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            color: var(--text);
            min-height: 100vh;
            line-height: 1.6;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 12px 24px;
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.95rem;
            transition: color 0.2s;
        }
        .back-link:hover { color: var(--primary-dark); }

        .container {
            max-width: 960px;
            margin: 0 auto;
            padding: 0 20px 40px;
        }

        header {
            text-align: center;
            padding: 20px 0 30px;
        }
        header h1 {
            font-family: Georgia, 'Times New Roman', serif;
            font-size: 2.2rem;
            color: var(--primary-dark);
            margin-bottom: 12px;
            letter-spacing: -0.5px;
        }
        header .subtitle {
            font-size: 1rem;
            color: var(--text-muted);
            max-width: 640px;
            margin: 0 auto;
        }

        .explanation {
            background: var(--surface);
            border: 1px solid var(--primary-border);
            border-left: 4px solid var(--primary);
            border-radius: var(--radius);
            padding: 20px 24px;
            margin-bottom: 24px;
            box-shadow: var(--shadow-sm);
        }
        .explanation p {
            font-size: 0.95rem;
            color: var(--text);
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
        }
        .btn:active { transform: scale(0.97); }

        .btn-primary {
            background: var(--primary);
            color: white;
            box-shadow: 0 2px 8px rgba(37,99,235,0.3);
        }
        .btn-primary:hover { background: var(--primary-dark); box-shadow: 0 4px 12px rgba(37,99,235,0.4); }

        .btn-secondary {
            background: var(--primary-bg);
            color: var(--primary);
            border: 1px solid var(--primary-border);
        }
        .btn-secondary:hover { background: #dbeafe; }

        .btn-danger {
            background: #fef2f2;
            color: #dc2626;
            border: 1px solid #fecaca;
        }
        .btn-danger:hover { background: #fee2e2; }

        .main-area {
            display: grid;
            grid-template-columns: 1fr 280px;
            gap: 20px;
            align-items: start;
        }

        .canvas-wrapper {
            background: var(--surface);
            border-radius: var(--radius);
            padding: 16px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }
        .canvas-wrapper canvas {
            display: block;
            width: 100%;
            height: auto;
            border-radius: 8px;
            cursor: crosshair;
            background: #fafbff;
        }
        .canvas-hint {
            text-align: center;
            padding-top: 8px;
            font-size: 0.82rem;
            color: var(--text-muted);
        }

        .stats-panel {
            background: var(--surface);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }
        .stats-panel h3 {
            font-family: Georgia, 'Times New Roman', serif;
            font-size: 1.1rem;
            color: var(--primary-dark);
            margin-bottom: 16px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-bg);
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
        }
        .stat-row:last-child { border-bottom: none; }

        .stat-label {
            font-size: 0.85rem;
            color: var(--text-muted);
        }
        .stat-value {
            font-family: 'SF Mono', 'Fira Code', monospace;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--primary-dark);
        }

        .equation-box {
            margin-top: 16px;
            padding: 14px;
            background: var(--primary-bg);
            border-radius: 8px;
            text-align: center;
            border: 1px solid var(--primary-border);
        }
        .equation-box .label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-muted);
            margin-bottom: 6px;
        }
        .equation-box .eq {
            font-family: 'SF Mono', 'Fira Code', monospace;
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary-dark);
        }

        .r2-bar-container {
            margin-top: 16px;
        }
        .r2-bar-container .label {
            font-size: 0.82rem;
            color: var(--text-muted);
            margin-bottom: 6px;
        }
        .r2-bar-bg {
            width: 100%;
            height: 10px;
            background: var(--border);
            border-radius: 5px;
            overflow: hidden;
        }
        .r2-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-light), var(--primary-dark));
            border-radius: 5px;
            transition: width 0.6s ease;
            width: 0%;
        }

        @media (max-width: 768px) {
            .main-area {
                grid-template-columns: 1fr;
            }
            header h1 { font-size: 1.6rem; }
            .controls { justify-content: center; }
        }
    </style>
</head>
<body>
    <a href="../index.html" class="back-link">&larr; Inapoi la Pagina Principala</a>

    <div class="container">
        <header>
            <h1>Regresie Liniara</h1>
            <p class="subtitle">Simulator interactiv pentru regresia liniara cu metoda celor mai mici patrate</p>
        </header>

        <div class="explanation">
            <p>
                <strong>Regresia liniara</strong> gaseste dreapta care se potriveste cel mai bine unui set de puncte,
                minimizand suma patratelor distantelor verticale dintre puncte si dreapta.
                Ecuatia dreptei este <strong>y = ax + b</strong>, unde <em>a</em> este panta iar <em>b</em> este interceptul.
                Coeficientul <strong>R&sup2;</strong> indica cat de bine se potriveste modelul (1 = perfect, 0 = nicio corelatie).
                Faceti clic pe suprafata de desenare pentru a adauga puncte, apoi apasati „Calculeaza".
            </p>
        </div>

        <div class="controls">
            <button class="btn btn-primary" id="btnCalc">Calculeaza</button>
            <button class="btn btn-secondary" id="btnNoise">Adauga Zgomot</button>
            <button class="btn btn-danger" id="btnReset">Reseteaza</button>
        </div>

        <div class="main-area">
            <div class="canvas-wrapper">
                <canvas id="canvas" width="600" height="400"></canvas>
                <div class="canvas-hint">Faceti clic pe suprafata pentru a adauga puncte de date</div>
            </div>

            <div class="stats-panel">
                <h3>Statistici</h3>

                <div class="stat-row">
                    <span class="stat-label">Numar de puncte</span>
                    <span class="stat-value" id="statN">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Panta (a)</span>
                    <span class="stat-value" id="statSlope">—</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Interceptul (b)</span>
                    <span class="stat-value" id="statIntercept">—</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">R&sup2;</span>
                    <span class="stat-value" id="statR2">—</span>
                </div>

                <div class="equation-box" id="eqBox" style="display:none;">
                    <div class="label">Ecuatia Dreptei</div>
                    <div class="eq" id="eqText">y = ax + b</div>
                </div>

                <div class="r2-bar-container" id="r2Container" style="display:none;">
                    <div class="label">R&sup2; — Calitatea potrivirii</div>
                    <div class="r2-bar-bg">
                        <div class="r2-bar-fill" id="r2Fill"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const W = canvas.width;
        const H = canvas.height;

        // Coordinate system: data space [0,10] x [0,10]
        const PAD = 40;
        const plotW = W - 2 * PAD;
        const plotH = H - 2 * PAD;
        const xMin = 0, xMax = 10, yMin = 0, yMax = 10;

        let points = [];
        let regression = null;

        function dataToCanvas(dx, dy) {
            const cx = PAD + ((dx - xMin) / (xMax - xMin)) * plotW;
            const cy = H - PAD - ((dy - yMin) / (yMax - yMin)) * plotH;
            return [cx, cy];
        }

        function canvasToData(cx, cy) {
            const dx = xMin + ((cx - PAD) / plotW) * (xMax - xMin);
            const dy = yMin + ((H - PAD - cy) / plotH) * (yMax - yMin);
            return [dx, dy];
        }

        function drawGrid() {
            ctx.clearRect(0, 0, W, H);

            // Background
            ctx.fillStyle = '#fafbff';
            ctx.fillRect(0, 0, W, H);

            // Grid lines
            ctx.strokeStyle = '#e8ecf4';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 10; i++) {
                const [x1, y1] = dataToCanvas(i, yMin);
                const [x2, y2] = dataToCanvas(i, yMax);
                ctx.beginPath();
                ctx.moveTo(x1, y1);
                ctx.lineTo(x2, y2);
                ctx.stroke();

                const [x3, y3] = dataToCanvas(xMin, i);
                const [x4, y4] = dataToCanvas(xMax, i);
                ctx.beginPath();
                ctx.moveTo(x3, y3);
                ctx.lineTo(x4, y4);
                ctx.stroke();
            }

            // Axes
            ctx.strokeStyle = '#94a3b8';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(PAD, PAD);
            ctx.lineTo(PAD, H - PAD);
            ctx.lineTo(W - PAD, H - PAD);
            ctx.stroke();

            // Axis labels
            ctx.fillStyle = '#64748b';
            ctx.font = '11px system-ui';
            ctx.textAlign = 'center';
            for (let i = 0; i <= 10; i += 2) {
                const [x] = dataToCanvas(i, 0);
                ctx.fillText(i, x, H - PAD + 18);
            }
            ctx.textAlign = 'right';
            for (let i = 0; i <= 10; i += 2) {
                const [, y] = dataToCanvas(0, i);
                ctx.fillText(i, PAD - 8, y + 4);
            }
        }

        function drawPoints() {
            points.forEach(([dx, dy]) => {
                const [cx, cy] = dataToCanvas(dx, dy);
                // Shadow
                ctx.beginPath();
                ctx.arc(cx, cy + 2, 6, 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(37,99,235,0.15)';
                ctx.fill();
                // Point
                ctx.beginPath();
                ctx.arc(cx, cy, 5, 0, Math.PI * 2);
                ctx.fillStyle = '#2563eb';
                ctx.fill();
                ctx.strokeStyle = '#ffffff';
                ctx.lineWidth = 2;
                ctx.stroke();
            });
        }

        function drawRegression() {
            if (!regression) return;
            const { a, b } = regression;

            // Draw line edge to edge of plot
            const y_at_xMin = a * xMin + b;
            const y_at_xMax = a * xMax + b;

            // Clip to plot area
            ctx.save();
            ctx.beginPath();
            ctx.rect(PAD, PAD, plotW, plotH);
            ctx.clip();

            const [x1, y1] = dataToCanvas(xMin, y_at_xMin);
            const [x2, y2] = dataToCanvas(xMax, y_at_xMax);

            // Line shadow
            ctx.strokeStyle = 'rgba(37,99,235,0.2)';
            ctx.lineWidth = 6;
            ctx.beginPath();
            ctx.moveTo(x1, y1 + 2);
            ctx.lineTo(x2, y2 + 2);
            ctx.stroke();

            // Line
            ctx.strokeStyle = '#dc2626';
            ctx.lineWidth = 2.5;
            ctx.setLineDash([]);
            ctx.beginPath();
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            ctx.stroke();

            // Residual lines
            ctx.strokeStyle = 'rgba(220,38,38,0.25)';
            ctx.lineWidth = 1;
            ctx.setLineDash([4, 4]);
            points.forEach(([dx, dy]) => {
                const predY = a * dx + b;
                const [cx1, cy1] = dataToCanvas(dx, dy);
                const [cx2, cy2] = dataToCanvas(dx, predY);
                ctx.beginPath();
                ctx.moveTo(cx1, cy1);
                ctx.lineTo(cx2, cy2);
                ctx.stroke();
            });
            ctx.setLineDash([]);

            ctx.restore();
        }

        function render() {
            drawGrid();
            drawRegression();
            drawPoints();
        }

        // Event: click to add point
        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const scaleX = W / rect.width;
            const scaleY = H / rect.height;
            const cx = (e.clientX - rect.left) * scaleX;
            const cy = (e.clientY - rect.top) * scaleY;

            if (cx < PAD || cx > W - PAD || cy < PAD || cy > H - PAD) return;

            const [dx, dy] = canvasToData(cx, cy);
            points.push([dx, dy]);
            regression = null;
            updateStats();
            render();
        });

        function computeRegression() {
            if (points.length < 2) return null;
            const n = points.length;
            let sumX = 0, sumY = 0, sumXY = 0, sumX2 = 0, sumY2 = 0;
            points.forEach(([x, y]) => {
                sumX += x;
                sumY += y;
                sumXY += x * y;
                sumX2 += x * x;
                sumY2 += y * y;
            });
            const meanX = sumX / n;
            const meanY = sumY / n;
            const denom = sumX2 - n * meanX * meanX;
            if (Math.abs(denom) < 1e-12) return null;

            const a = (sumXY - n * meanX * meanY) / denom;
            const b = meanY - a * meanX;

            // R squared
            let ssTot = 0, ssRes = 0;
            points.forEach(([x, y]) => {
                ssTot += (y - meanY) ** 2;
                ssRes += (y - (a * x + b)) ** 2;
            });
            const r2 = ssTot === 0 ? 1 : 1 - ssRes / ssTot;

            return { a, b, r2 };
        }

        function updateStats() {
            document.getElementById('statN').textContent = points.length;
            if (regression) {
                document.getElementById('statSlope').textContent = regression.a.toFixed(4);
                document.getElementById('statIntercept').textContent = regression.b.toFixed(4);
                document.getElementById('statR2').textContent = regression.r2.toFixed(4);

                document.getElementById('eqBox').style.display = 'block';
                const sign = regression.b >= 0 ? '+' : '−';
                const absB = Math.abs(regression.b).toFixed(3);
                document.getElementById('eqText').textContent = `y = ${regression.a.toFixed(3)}x ${sign} ${absB}`;

                document.getElementById('r2Container').style.display = 'block';
                document.getElementById('r2Fill').style.width = (Math.max(0, regression.r2) * 100) + '%';
            } else {
                document.getElementById('statSlope').textContent = '—';
                document.getElementById('statIntercept').textContent = '—';
                document.getElementById('statR2').textContent = '—';
                document.getElementById('eqBox').style.display = 'none';
                document.getElementById('r2Container').style.display = 'none';
            }
        }

        // Buttons
        document.getElementById('btnCalc').addEventListener('click', () => {
            if (points.length < 2) return;
            regression = computeRegression();
            updateStats();
            render();
        });

        document.getElementById('btnNoise').addEventListener('click', () => {
            if (points.length === 0) return;
            points = points.map(([x, y]) => {
                const nx = x + (Math.random() - 0.5) * 1.2;
                const ny = y + (Math.random() - 0.5) * 1.2;
                return [Math.max(0, Math.min(10, nx)), Math.max(0, Math.min(10, ny))];
            });
            if (regression) {
                regression = computeRegression();
            }
            updateStats();
            render();
        });

        document.getElementById('btnReset').addEventListener('click', () => {
            points = [];
            regression = null;
            updateStats();
            render();
        });

        // Initial render
        render();
        updateStats();
    </script>
</body>
</html>
